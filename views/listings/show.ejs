<% layout("layouts/boilerplate") %>

  <body>
    <div class="row">
      <div class="col-6 offset-2">
        <h3>
          <%= listing.title %>
        </h3>
      </div>
      <div class="card col-6 offset-2" style="width: 50rem;">
        <img src="<%= listing.image%>" class="card-img-top" alt="listing_image" style="height:20rem">
        <div class="card-img-overlay"></div>
        <div class="card-body">
          <p class="card-text">
            <%= listing.description %> <br>
              <b>Price:</b>
              &#8377;<%= listing.price.toLocaleString("en-IN") %>
                <br>
                <b>Country:</b>
                <%=listing.country %>
                  <br>
                  <b>Location:</b>
                  <%=listing.location %>

          </p>

        </div>
      </div>

      <div class="btns col-5 offset-2">
        <a href="/listings/<%= listing._id %>/edit" class="btn btn-dark">Edit this Listing</a>
        <form method="POST" action="/listings/<%=listing._id%>?_method=DELETE">
          <button class="btn btn-danger">Delete this listing</button>
        </form>
        <hr>
      </div>



      <div class="card col-6 offset-2">
        <hr>
        <h4>Leave a Review</h4>
        <form action="/listings/<%=listing._id %>/reviews" method="post" class="needs-validation" novalidate>
          <div class="mb-3 mt-2">
            <label for="rating" class="form-label">Rating</label>
            <input type="range" class="form-range" id="rating" min="1" max="5" name="review[rating]">
          </div>
          <div class="mb-3 mt-2">
            <label for="comments" class="form-label">Give Comments</label>
            <textarea name="review[comment]" class="form-control" id="comments" cols="80" row="10" required></textarea>
            <div class="invalid-feedback">Comment cannot be empty</div>
          </div>
          <div class="mb-3 mt-2">
            <button class="btn btn-outline-dark">Submit</button>
          </div>
        </form>
      </div>

      <div class="card col-6 offset-2">
        <hr>
        <h4>All reviews: </h4>
        <div class="row ">
        <% for(review of listing.reviews){ %>
          <div class="card review-card col-5 ms-2 mb-3">
            <div class="card-body">
              <h5 class="card-title">UserName</h5>
              <p class="card-text"><%=review.comment%></p>
              <p class="card-text"><%=review.rating%> stars</p>
              <form class="mb-3" action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE" method="post">
                <button class="btn btn-sm btn-danger">Delete</button>
              </form>
            </div>
          </div>
          <% } %>
        </div>
      </div>
    </div>
  </body>